# 원가산정 집계 – 사용자 입력 매뉴얼

## 1. 화면 구성

- **좌측**: 시나리오명 입력
- **중앙**: 탭(기준년도, 직무별 인원입력, 경비입력, 요약, 노무비 상세, 경비 상세, 시나리오 비교)
- **우측**: 도넛 차트
- **하단**: 집계 실행, 시나리오 저장, 시나리오 불러오기, 요약 PDF 내보내기, 상세 Excel 내보내기
- **상단 메뉴**: 설정, 도구(노임단가 비교)

---

## 2. 기본 흐름

1. **시나리오명** 입력(좌측)
2. **직무별 인원입력** 탭에서 직무·인원·근로일 등 입력
3. **경비입력** 탭에서 경비코드별 세부 항목 수량·단가 입력
4. **시나리오 저장** 클릭
5. **집계 실행** 클릭
6. **요약** / **노무비 상세** / **경비 상세** 탭에서 결과 확인
7. 필요 시 **요약 PDF** 또는 **상세 Excel** 내보내기

**기본 프로그램 입력을 모두 마친 후**에는 위 4→5(저장→집계)까지 진행한 뒤, **엑셀 출력(상세 Excel 내보내기)** 또는 **요약 PDF 내보내기**를 진행하면 됩니다. 집계를 한 번 실행한 시나리오만 내보내기가 가능합니다.

---

## 2-1. 입력 및 시나리오 불러오기 (자세히)

### 입력이 저장·불러오기에 반영되는 흐름

1. **입력 위치**
   - **좌측 시나리오명**: 현재 작업 중인 시나리오 이름. 저장/불러오기/집계 시 이 이름이 사용됩니다.
   - **직무별 인원입력 탭**: 직무코드(콤보), 직무명·직종(자동), 근무일수·근무시간·연장·휴일근로·인원 수를 입력합니다.
   - **경비입력 탭**: 경비코드(콤보)별로 세부코드·항목명·규격·단위·수량·단가 등을 입력합니다. 금액은 자동 계산됩니다.

2. **시나리오 저장(하단 버튼)**
   - 좌측 **시나리오명**에 적힌 이름으로, **현재** 직무별 인원입력·경비입력 내용이 DB에 저장됩니다.
   - 같은 이름이 있으면 덮어쓰고, 없으면 새 시나리오로 추가됩니다.
   - 저장 후에는 해당 시나리오를 나중에 “시나리오 불러오기”로 다시 불러올 수 있습니다.

3. **시나리오 불러오기(하단 버튼)**
   - **입력**: 좌측 시나리오명 란에 불러올 시나리오 이름을 **직접 입력**합니다. (예: `2023_기본`, `test_1`)
   - **동작**: 그 이름에 해당하는 시나리오를 DB에서 찾아, **직무별 인원입력**·**경비입력** 탭에 그대로 채웁니다.
   - **조건**: 테이블 셀 편집 중이거나, 저장되지 않은 변경이 있으면 “편집을 마치거나 저장 후 시도하세요” 등 메시지가 나올 수 있습니다.
   - **결과**: 불러온 시나리오가 “현재 작업 시나리오”가 되며, 이전에 그 시나리오로 집계한 결과가 있으면 요약·노무비 상세·경비 상세에도 다시 표시됩니다.

4. **정리**
   - **저장** = 지금 화면에 입력한 내용을 “시나리오명”이라는 이름으로 DB에 남기는 것.
   - **불러오기** = 이미 저장된 “시나리오명”의 데이터를 DB에서 꺼내서 화면(직무·경비 입력란 등)에 다시 채우는 것.
   - 시나리오 비교 탭의 펼침목록·불러오기는 **비교용**이며, 위 “하단 시나리오 불러오기”와는 별개입니다(섹션 10.1 참고).

---

## 3. 시나리오명(좌측 패널)

| 항목 | 설명 |
|------|------|
| 시나리오명 | 저장/불러오기/집계에 사용되는 이름. 영문·숫자·하이픈·언더스코어만 파일명으로 사용됨. |

- **저장**: 하단 **시나리오 저장**으로 현재 입력이 이 이름으로 DB에 저장됨.
- **불러오기**: 시나리오명을 입력한 뒤 **시나리오 불러오기**로 해당 시나리오를 불러옴.
- 변경 시 창 제목에 `*` 표시(미저장 상태). 저장 후 `*` 제거.

---

## 4. 기준년도 탭

- 기준년도 등 기준 데이터 표시/설정용.
- (구체 항목은 화면 기준으로 입력)

---

## 5. 직무별 인원입력 탭

직무별로 인원·근로일·근로시간·연장·휴일근무를 입력합니다.

| 컬럼 | 설명 | 입력 |
|------|------|------|
| 직무(직종) | 콤보에서 선택 | 드롭다운 선택 |
| 직무명 | 표시용(읽기 전용) | - |
| 근로일수 | 월 기준 근로일 수 | 숫자(소수 가능) |
| 근로시간 | 1일 근로시간 | 숫자 |
| 연장근로시간 | 월 연장 근로 시간 | 숫자 |
| 휴일근로시간 | 월 휴일 근로 시간 | 숫자 |
| 인원수 | 해당 직무 인원 | 숫자(정수) |

- **행 추가**: 빈 행에 직무 선택 후 값 입력.
- **행 삭제**: 행 선택 후 삭제 버튼(있는 경우) 또는 해당 기능 사용.
- 인원수 0이면 집계에서 제외됨.
- **저장** 시 이 탭 데이터가 시나리오와 함께 저장됨.

---

## 6. 경비입력 탭

경비코드별 **세부 항목**을 입력합니다. 모든 경비는 여기서만 입력합니다.

### 6.1 경비코드 선택

- 상단 **경비코드** 콤보에서 항목 선택.
- 표시: `[그룹명] 경비코드 - 항목명` (고정비/변동비/대행비 그룹 순).

### 6.2 세부 항목 테이블

| 컬럼 | 설명 | 비고 |
|------|------|------|
| 세부코드 | 세부 항목 식별 코드 | 입력 필수(비어 있으면 저장 시 해당 행 제외) |
| 항목명 | 세부 항목명 | |
| 규격 | 규격/용도 | |
| 단위 | 단위(회, 식, 원/월 등) | |
| 수량 | 수량(일부 항목은 **인원 수**) | 천 단위 콤마 표시 |
| 단가 | 단가(원) | 콤마 표시, 원 단위 |
| 금액 | 수량×단가(자동 계산) | 읽기 전용 |
| 비고 | 비고 | 교육훈련비·출장여비는 자동 계산·읽기 전용 |
| 정렬 | 정렬 순서 | 숫자 |

### 6.3 특수 동작

- **교육훈련비 / 출장여비**  
  - 수량 컬럼 이름이 **인원 수**로 바뀌며, **정수만** 입력.  
  - 비고는 `N인×1회/년÷12개월` 형태로 **자동 계산**·읽기 전용.

- **피복비 / 건강검진비**  
  - 수량은 **연간 지급 수량** 입력 → 내부적으로 ÷12 해서 월 단위로 저장·계산.

- **의약품비**  
  - 수량은 연간 SET 입력 → 직무별 인원 합계로 나눠서 저장·계산.

- **인적보험 7개**(산재·국민연금·고용·건강·노인장기요양·임금채권·석면)  
  - **노무비에서 자동 계산**되어 1행씩 표시됨.  
  - 셀 **읽기 전용**. 집계 실행 후 값 갱신.

- **안전관리비**  
  - 설정의 지급요율로 **직접노무비×요율** 자동 계산(세부 입력 무시 가능).

### 6.4 행 추가·삭제

- **행 추가**: 버튼으로 빈 행 추가 후, **세부코드**를 포함해 입력. 세부코드가 비어 있는 행은 저장 시 제외됨.
- **행 삭제**: 버튼으로 선택 행 삭제.

### 6.5 저장

- **시나리오 저장** 시 현재 선택된 경비코드의 테이블을 포함해 **경비코드별 세부 항목**이 DB에 저장됨.
- 인적보험 7개는 DB에 저장하지 않음(매번 집계 시 노무비에서 채움).

---

## 7. 하단 버튼

| 버튼 | 동작 |
|------|------|
| **집계 실행** | 현재 시나리오명 기준으로 저장된 데이터로 노무비·경비를 계산하고 요약/상세 탭·차트를 갱신. **저장되지 않은 변경이 있으면** 먼저 저장하라는 메시지 표시. |
| **시나리오 저장** | 좌측 시나리오명으로 직무별 인원·경비입력(세부) 데이터를 DB에 저장. |
| **시나리오 불러오기** | 시나리오명에 해당하는 시나리오를 DB에서 불러와 직무·경비 탭에 표시. |
| **요약 PDF 내보내기** | 집계 결과 요약을 PDF로 저장. 집계를 한 번 실행한 뒤 사용. |
| **상세 Excel 내보내기** | 집계 상세를 Excel 파일로 저장. 집계를 한 번 실행한 뒤 사용. |

- **집계 실행** 전에 반드시 **시나리오 저장**을 해야 최신 입력이 반영됩니다.
- 편집 중(셀 편집 포커스)이거나 변경사항이 있으면 일부 동작이 제한될 수 있습니다. 저장 후 다시 시도하세요.

---

## 8. 메뉴

### 설정

- **설정 열기...**: 안전관리비 지급요율 등 설정 창을 엽니다.

### 도구

- **노임단가 비교...**: 노임단가 비교 도구를 엽니다.

---

## 9. 요약 / 노무비 상세 / 경비 상세 탭

- **집계 실행** 후 결과가 채워짐.
- **요약**: 노무비·고정비·변동비·대행비 등 합계.
- **노무비 상세**: 직무별 노무비 상세.
- **경비 상세**: 경비코드별·세부 항목별 금액.

---

## 10. 시나리오 비교 탭

- **시나리오 A** / **시나리오 B** 각각 **펼침목록(콤보)** 에서 비교할 시나리오를 고른 뒤 **불러오기**를 누르면, 해당 시나리오의 입력·집계 결과만 비교용으로 로드됩니다.
- **새로고침**: DB에 저장된 시나리오 목록을 다시 읽어 펼침목록을 갱신합니다.
- **비교**: A·B를 모두 불러온 뒤 **비교** 버튼을 누르면 증감 상위 3개 항목과 시나리오 비교 테이블이 채워집니다.
- **비교 결과 PDF 저장**: 비교 결과를 PDF로 저장합니다.

### 10.1 시나리오 펼침목록(비교 탭) vs 하단 시나리오 불러오기

| 구분 | 시나리오 비교 탭의 펼침목록 + 불러오기 | UI 하단 시나리오 불러오기 |
|------|----------------------------------------|----------------------------|
| **위치** | 시나리오 비교 탭 안, 시나리오 A / 시나리오 B 블록 | 화면 맨 아래 버튼 바 |
| **용도** | 두 시나리오를 **비교**하기 위해 A·B 슬롯에 각각 로드 | **현재 작업할 시나리오**를 전체 프로그램에 로드 |
| **영향 범위** | 비교 탭의 비교 테이블·증감 표만 갱신. 다른 탭(직무별 인원, 경비입력 등)은 **변경되지 않음** | 좌측 시나리오명, 직무별 인원입력, 경비입력, 요약/노무비·경비 상세 등 **전체 입력·결과**가 해당 시나리오로 바뀜 |
| **입력** | 펼침목록에서 시나리오 선택 후 **불러오기** 버튼 클릭 | 좌측 **시나리오명**을 입력(또는 수정)한 뒤 **시나리오 불러오기** 버튼 클릭 |
| **사용 시점** | “저장된 시나리오 A와 B를 비교만 하고 싶을 때” | “저장된 시나리오를 불러와서 수정·재집계·저장하고 싶을 때” |

---

## 11. 주의사항

1. **저장 후 집계**: 입력을 바꾼 뒤에는 **시나리오 저장** → **집계 실행** 순서로 진행하세요.
2. **시나리오명**: 불러오기·저장·내보내기 파일명에 사용되므로, 영문·숫자·`-`, `_` 위주로 쓰는 것이 안전합니다.
3. **경비입력**: 세부코드가 비어 있는 행은 저장되지 않습니다. 행을 추가했다면 세부코드까지 반드시 입력하세요.
4. **인적보험 7개**: 값은 집계 시 자동으로 채워지며, 수정할 수 없습니다.
5. **내보내기**: PDF/Excel 내보내기는 **저장이 완료된 상태**에서, **한 번이라도 집계 실행**한 뒤에 사용할 수 있습니다.

---

## 12. 실행 방법

```bash
# 프로젝트 루트에서
python -m src.main
# 또는
python src/main.py
```

DB 및 마이그레이션은 실행 시 자동으로 수행됩니다.

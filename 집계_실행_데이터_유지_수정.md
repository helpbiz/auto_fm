# 집계 실행 시 UI 데이터 유지 수정 완료

## 문제 상황
기존에는 "집계 실행" 버튼을 클릭하면 UI의 입력 데이터가 초기화되어 사라지는 문제가 있었습니다.

## 원인 분석
**파일**: [main_window.py:430](src/ui/main_window.py#L430)

```python
def calculate(self):
    ...
    scenario_id = self._sanitize_filename(scenario_name)
    self._refresh_master_data(scenario_id)  # ← 문제 발생 지점
    ...
```

`_refresh_master_data()` 메서드가 다음과 같은 동작을 수행했습니다:
1. DB에서 마스터 데이터(직무 목록, 경비 항목) 읽기
2. `job_role_table.load_roles()` 호출 → **테이블 초기화** (`setRowCount(0)`)
3. `expense_input_table.load_items()` 호출 → **테이블 초기화**

결과적으로 사용자가 입력한 모든 데이터가 초기화되었습니다.

## 수정 내용

### 변경 전 (Before)
```python
def calculate(self):
    ...
    values = self.input_panel.get_values()
    scenario_name = values["scenario_name"] or "default"
    scenario_id = self._sanitize_filename(scenario_name)
    self._refresh_master_data(scenario_id)  # ← 데이터 초기화 발생!

    conn = get_connection()
    try:
        result = calculate_result(scenario_id, conn, ...)
```

### 변경 후 (After)
```python
def calculate(self):
    ...
    values = self.input_panel.get_values()
    scenario_name = values["scenario_name"] or "default"
    scenario_id = self._sanitize_filename(scenario_name)
    # _refresh_master_data(scenario_id) 호출 제거 ← 데이터 유지!

    conn = get_connection()
    try:
        result = calculate_result(scenario_id, conn, ...)
```

**수정 위치**: [main_window.py:430](src/ui/main_window.py#L430)
- `self._refresh_master_data(scenario_id)` 라인 제거

## 동작 흐름 비교

### Before (이전)
```
1. 사용자가 직무별 인원, 경비 항목 입력
2. "집계 실행" 버튼 클릭
3. _refresh_master_data() 호출
   → 테이블 초기화 (setRowCount(0))
   → 입력 데이터 모두 사라짐 ❌
4. DB에서 빈 데이터로 계산 수행
5. 결과 업데이트
```

### After (현재)
```
1. 사용자가 직무별 인원, 경비 항목 입력
2. "집계 실행" 버튼 클릭
3. 현재 테이블의 데이터를 그대로 유지 ✅
4. 입력된 데이터로 계산 수행
5. 계산 결과만 업데이트
```

## _refresh_master_data의 다른 사용처

`_refresh_master_data()`는 다음 두 곳에서는 계속 사용됩니다 (정상 동작):

1. **초기화 시** ([main_window.py:216](src/ui/main_window.py#L216))
   ```python
   def __init__(self):
       ...
       self._refresh_master_data("default")  # 앱 시작 시 마스터 데이터 로드
   ```

2. **시나리오 불러오기 시** ([main_window.py:615](src/ui/main_window.py#L615))
   ```python
   def load_scenario(self):
       ...
       self._refresh_master_data(scenario_id)  # 새 시나리오의 마스터 데이터 로드
       self._apply_canonical_input(canonical)  # 저장된 입력 데이터 적용
   ```

이 두 경우는 새로운 데이터를 로드하는 것이 맞으므로 그대로 유지됩니다.

## 테스트 시나리오

### 정상 케이스
1. 직무 입력: 소장 1명, 공무 2명
2. 경비 입력: 사무용품 100개, 소모품 50개
3. **"집계 실행" 버튼 클릭**
   - **기대 결과**: 입력한 데이터가 그대로 유지되고, 노무비 상세/경비 상세/요약 패널만 업데이트됨 ✅

### 데이터 유지 확인
1. 인원 구성 입력 테이블의 데이터가 사라지지 않음 ✅
2. 경비 입력 테이블의 데이터가 사라지지 않음 ✅
3. 계산 결과만 갱신됨 ✅

## 결론
"집계 실행" 버튼 클릭 시 UI 입력 데이터를 초기화하지 않고, 현재 테이블의 데이터를 읽어서 계산 결과만 업데이트하도록 수정 완료했습니다.

## 관련 파일
- **수정 파일**: [main_window.py](src/ui/main_window.py)
- **수정 메서드**: `calculate()` (lines 415-464)
- **제거 라인**: Line 430 (`self._refresh_master_data(scenario_id)`)

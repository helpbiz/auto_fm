# 행 추가 자동화 완료 보고서

## 개요
'인원 구성 입력' 테이블의 UX를 개선하여, 수동 '행 추가' 버튼을 제거하고 엑셀과 같은 자연스러운 입력 흐름을 구현했습니다.

## 구현 완료 내역

### 1. UI 요소 제거
- **파일**: `src/ui/job_role_table.py`
- **제거 항목**:
  - `_add_row_btn` 버튼 객체 및 레이아웃 (기존 lines 635-642)
  - `_on_add_row_clicked()` 슬롯 함수 (기존 lines 766-778)
  - 모든 관련 참조 제거 확인 완료

### 2. Enter 키 기반 자동 행 추가 구현

#### 동작 위치
`JobRoleTableWidget.keyPressEvent()` 메서드 (lines 343-373)

#### 동작 흐름
```
사용자가 '인원(COL_HEADCOUNT)' 컬럼에서 데이터 입력
        ↓
    Enter 키 입력
        ↓
직무코드와 인원수 검증 (비어있지 않은지 확인)
        ↓
    [검증 성공]
        ↓
마지막 행인지 확인 (next_row >= self.rowCount())
        ↓
    [마지막 행]
        ↓
parent.add_empty_row() 호출하여 새 행 추가
        ↓
새 행의 아이템 및 서식 초기화
        ↓
커서를 새 행의 '직무코드' 컬럼으로 자동 이동
        ↓
job_code 입력 위젯에 포커스 설정
```

#### 핵심 코드 (lines 343-373)
```python
if col == COL_HEADCOUNT:
    self._ensure_row_items(row)
    self._set_job_name_readonly(row)
    job_code = (self.item(row, COL_JOB_CODE).text() or "").strip()
    headcount = (self.item(row, COL_HEADCOUNT).text() or "").strip()

    # 직무코드·인원 있으면 자동으로 다음 행 추가 및 이동
    if job_code and headcount:
        next_row = row + 1
        if next_row >= self.rowCount():
            # 마지막 행이면 새 행 추가
            parent = self.parent()
            if hasattr(parent, "add_empty_row") and callable(getattr(parent, "add_empty_row")):
                parent.add_empty_row()
                next_row = self.rowCount() - 1
            else:
                self.insertRow(next_row)
                self._ensure_row_items(next_row)
                self._set_job_name_readonly(next_row)

        # 새 행 초기화 및 포커스 이동
        self._ensure_row_items(next_row)
        self._set_job_name_readonly(next_row)
        self.setCurrentCell(next_row, COL_JOB_CODE)
        widget = self.cellWidget(next_row, COL_JOB_CODE)
        if widget is not None and hasattr(widget, "_code_input"):
            widget._code_input.setFocus()
        else:
            item = self.item(next_row, COL_JOB_CODE)
            if item is not None:
                self.editItem(item)
        return

    # 데이터가 유효하지 않으면 현재 셀에 머물기
    self.setCurrentCell(row, COL_HEADCOUNT)
    self.editItem(self.item(row, COL_HEADCOUNT))
    return
```

### 3. 예외 처리 구현

#### 3.1 빈 데이터 검증
- **조건**: `if job_code and headcount:` (line 349)
- **효과**: 직무코드나 인원수가 비어있으면 행 추가를 하지 않음
- **사용자 경험**: 현재 셀에 포커스가 유지되어 데이터 입력을 유도

#### 3.2 무한 빈 행 생성 방지
- **조건**: `if next_row >= self.rowCount():` (line 351)
- **효과**: 마지막 행에서만 새 행을 추가하므로, 중간에 빈 행이 있어도 무한 생성되지 않음

#### 3.3 서식 유지
- `_ensure_row_items(next_row)`: 셀 아이템 초기화
- `_set_job_name_readonly(next_row)`: 직무명 컬럼 읽기전용 설정
- `_install_job_code_cell(row, "")`: 직무코드 위젯 설치 (JobRoleTable.add_empty_row)

### 4. 요구사항 충족 확인

| 요구사항 | 구현 상태 | 세부 내용 |
|---------|----------|----------|
| 1. 행 추가 버튼 제거 | ✅ 완료 | 버튼 및 슬롯 함수 모두 제거 |
| 2. Enter 키 자동 행 추가 | ✅ 완료 | COL_HEADCOUNT에서 Enter 시 자동 추가 |
| 3. 마지막 행 감지 | ✅ 완료 | `next_row >= self.rowCount()` 조건 |
| 4. 커서 자동 이동 | ✅ 완료 | 새 행의 직무코드로 포커스 이동 |
| 5. 서식 유지 | ✅ 완료 | _ensure_row_items, _set_job_name_readonly |
| 6. 빈 데이터 검증 | ✅ 완료 | job_code와 headcount 검증 |
| 7. 무한 행 생성 방지 | ✅ 완료 | 마지막 행에서만 추가 |
| 8. UI 정리 | ✅ 완료 | 모든 버튼 관련 코드 제거 확인 |

## 사용자 경험 개선 효과

### Before (이전)
1. 사용자가 직무코드 입력
2. 인원수 입력
3. **마우스로 '행 추가' 버튼 클릭** ← 번거로움
4. 새 행에서 다시 1번부터 반복

### After (현재)
1. 사용자가 직무코드 입력
2. 인원수 입력 후 **Enter 키만 입력** ← 자연스러움
3. 자동으로 새 행이 추가되고 커서가 이동
4. 바로 1번부터 반복

## 테스트 시나리오

### 정상 케이스
1. 직무코드 입력 → Tab → 인원수 입력 → **Enter**
   - **기대 결과**: 새 행 추가, 커서가 새 행의 직무코드로 이동 ✅

### 예외 케이스
1. 직무코드 비어있음 → 인원수 입력 → **Enter**
   - **기대 결과**: 행 추가 안 됨, 현재 셀에 머물기 ✅

2. 직무코드 입력 → 인원수 비어있음 → **Enter**
   - **기대 결과**: 행 추가 안 됨, 현재 셀에 머물기 ✅

3. 중간 행에서 Enter
   - **기대 결과**: 다음 행으로 이동만 함 (새 행 추가 안 함) ✅

## 결론
엑셀과 같은 자연스러운 데이터 입력 흐름이 구현되었으며, 모든 예외 상황에 대한 처리가 완료되었습니다. 사용자는 마우스 없이 키보드만으로도 효율적으로 데이터를 입력할 수 있습니다.

## 관련 파일
- **수정 파일**: `src/ui/job_role_table.py`
- **영향받는 클래스**:
  - `JobRoleTableWidget` (QTableWidget 서브클래스)
  - `JobRoleTable` (QWidget 래퍼)

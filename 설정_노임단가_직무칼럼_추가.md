# 설정 메뉴 - 기술자 노임단가 '직무' 칼럼 추가 완료

## 수정 개요
"설정 > 기술자 노임단가" 테이블에 직무코드 다음에 '직무' 칼럼을 추가하여 직무명을 표시하도록 개선했습니다.

## 수정 파일
- **파일**: [settings_dialog.py](src/ui/settings_dialog.py)

## 수정 내역

### 1. 테이블 구조 변경 (Line 104-107)

**변경 전**:
```python
self.tech_table = QTableWidget(0, 2)
self.tech_table.setHorizontalHeaderLabels(["직무코드", "일급(원)"])
```

**변경 후**:
```python
self.tech_table = QTableWidget(0, 3)
self.tech_table.setHorizontalHeaderLabels(["직무코드", "직무", "일급(원)"])
```

- 컬럼 수: 2개 → 3개
- 컬럼 구성:
  - 0: 직무코드 (편집 가능)
  - 1: 직무 (읽기전용) ← **새로 추가**
  - 2: 일급(원) (편집 가능)

### 2. Import 추가 (Line 30)

```python
from src.domain.constants.job_data import get_job_mapping_from_file
```

직무코드로 직무명을 조회하기 위해 job_data 모듈 import

### 3. 데이터 로드 시 직무명 표시 (_load 메서드, Lines 147-163)

**변경 전**:
```python
tech = config.get("technician_daily_rates", {}) or {}
self.tech_table.setRowCount(len(tech))
for row, (code, wage) in enumerate(tech.items()):
    self.tech_table.setItem(row, 0, QTableWidgetItem(str(code)))
    self.tech_table.setItem(row, 1, QTableWidgetItem(f"{int(wage):,}"))
```

**변경 후**:
```python
tech = config.get("technician_daily_rates", {}) or {}
job_mapping = get_job_mapping_from_file()
self.tech_table.setRowCount(len(tech))
for row, (code, wage) in enumerate(tech.items()):
    # 직무코드
    code_item = QTableWidgetItem(str(code))
    self.tech_table.setItem(row, 0, code_item)

    # 직무명 (읽기전용)
    job_name = job_mapping.get(code, "")
    name_item = QTableWidgetItem(job_name)
    name_item.setFlags(name_item.flags() & ~Qt.ItemFlag.ItemIsEditable)
    name_item.setTextAlignment(Qt.AlignmentFlag.AlignCenter | Qt.AlignmentFlag.AlignVCenter)
    self.tech_table.setItem(row, 1, name_item)

    # 일급
    wage_item = QTableWidgetItem(f"{int(wage):,}")
    wage_item.setTextAlignment(Qt.AlignmentFlag.AlignCenter | Qt.AlignmentFlag.AlignVCenter)
    self.tech_table.setItem(row, 2, wage_item)
```

**특징**:
- 직무명은 읽기전용으로 설정 (`~Qt.ItemFlag.ItemIsEditable`)
- 가운데 정렬 적용
- job_mapping을 통해 직무코드로 직무명 자동 조회

### 4. 행 추가 시 직무명 셀 생성 (_add_tech_row 메서드, Lines 165-177)

**변경 전**:
```python
def _add_tech_row(self):
    r = self.tech_table.rowCount()
    self.tech_table.insertRow(r)
    self.tech_table.setItem(r, 0, QTableWidgetItem(""))
    self.tech_table.setItem(r, 1, QTableWidgetItem("0"))
```

**변경 후**:
```python
def _add_tech_row(self):
    r = self.tech_table.rowCount()
    self.tech_table.insertRow(r)
    # 직무코드
    self.tech_table.setItem(r, 0, QTableWidgetItem(""))
    # 직무명 (읽기전용, 비어있음)
    name_item = QTableWidgetItem("")
    name_item.setFlags(name_item.flags() & ~Qt.ItemFlag.ItemIsEditable)
    name_item.setTextAlignment(Qt.AlignmentFlag.AlignCenter | Qt.AlignmentFlag.AlignVCenter)
    self.tech_table.setItem(r, 1, name_item)
    # 일급
    wage_item = QTableWidgetItem("0")
    wage_item.setTextAlignment(Qt.AlignmentFlag.AlignCenter | Qt.AlignmentFlag.AlignVCenter)
    self.tech_table.setItem(r, 2, wage_item)
```

### 5. 저장 시 컬럼 인덱스 수정 (_collect_tech_rates 메서드, Line 184)

**변경 전**:
```python
wage_item = self.tech_table.item(row, 1)
```

**변경 후**:
```python
wage_item = self.tech_table.item(row, 2)  # 일급은 이제 컬럼 2
```

일급 컬럼이 1에서 2로 이동했으므로 인덱스 수정

### 6. 직무코드 입력 시 자동 직무명 채우기 (새 메서드 추가, Lines 150-163)

**신규 기능**:
```python
def _on_tech_item_changed(self, item):
    """직무코드 변경 시 자동으로 직무명 채우기"""
    if item.column() == 0:  # 직무코드 컬럼
        row = item.row()
        code = (item.text() or "").strip()
        if code:
            job_mapping = get_job_mapping_from_file()
            job_name = job_mapping.get(code, "")
            name_item = self.tech_table.item(row, 1)
            if name_item:
                # 시그널 차단하여 무한 루프 방지
                self.tech_table.blockSignals(True)
                name_item.setText(job_name)
                self.tech_table.blockSignals(False)
```

**시그널 연결** (Line 107):
```python
self.tech_table.itemChanged.connect(self._on_tech_item_changed)
```

**동작 방식**:
1. 사용자가 직무코드를 입력 (예: "A001")
2. itemChanged 시그널 발생
3. _on_tech_item_changed 핸들러 호출
4. job_mapping에서 직무명 조회 (예: "소장")
5. 직무 칼럼에 자동으로 직무명 표시

## 사용자 경험 개선

### Before (이전)
```
┌──────────┬────────────┐
│ 직무코드 │  일급(원)  │
├──────────┼────────────┤
│  A001    │  400,000   │
│  A002    │  350,000   │
└──────────┴────────────┘
```
- 직무코드만 보고 어떤 직무인지 알기 어려움
- 설정 파일을 확인하기 불편함

### After (현재)
```
┌──────────┬──────────┬────────────┐
│ 직무코드 │   직무   │  일급(원)  │
├──────────┼──────────┼────────────┤
│  A001    │   소장   │  400,000   │
│  A002    │   공무   │  350,000   │
└──────────┴──────────┴────────────┘
```
- 직무명이 함께 표시되어 한눈에 파악 가능 ✅
- 직무코드 입력 시 자동으로 직무명 표시 ✅
- 읽기전용으로 실수 방지 ✅

## 실제 사용 예시

### 1. 기존 데이터 로드
```
설정 > 기술자 노임단가 탭 열기
→ config.json의 technician_daily_rates 로드
→ 각 직무코드에 대해 job_mapping에서 직무명 조회
→ 테이블에 [직무코드, 직무명, 일급] 표시
```

### 2. 새 행 추가
```
"행 추가" 버튼 클릭
→ 빈 행 생성 [빈 코드, 빈 직무명(읽기전용), 0원]
→ 직무코드 입력 (예: "B001")
→ 자동으로 직무명 표시 (예: "전기기사")
→ 일급 입력 (예: "300,000")
→ 저장
```

### 3. 저장 시
```
config.json에는 여전히 직무코드와 일급만 저장됨
{
  "technician_daily_rates": {
    "A001": 400000,
    "B001": 300000
  }
}
```
- 직무명은 표시용이므로 저장되지 않음
- 매번 job_mapping에서 동적으로 조회

## 기술적 특징

### 1. 읽기전용 설정
```python
name_item.setFlags(name_item.flags() & ~Qt.ItemFlag.ItemIsEditable)
```
- 직무명은 자동 조회되므로 사용자가 편집할 수 없도록 설정
- 데이터 일관성 유지

### 2. 가운데 정렬
```python
item.setTextAlignment(Qt.AlignmentFlag.AlignCenter | Qt.AlignmentFlag.AlignVCenter)
```
- 직무명과 일급 모두 가운데 정렬하여 깔끔한 UI

### 3. 무한 루프 방지
```python
self.tech_table.blockSignals(True)
name_item.setText(job_name)
self.tech_table.blockSignals(False)
```
- setText 시 itemChanged 시그널이 다시 발생하는 것을 방지

### 4. 동적 조회
- 직무명은 config.json에 저장하지 않고 매번 job_mapping에서 조회
- job_data가 업데이트되면 자동으로 반영됨

## 결론
"설정 > 기술자 노임단가" 테이블에 '직무' 칼럼을 추가하여 사용자가 직무코드만 보고도 어떤 직무인지 쉽게 파악할 수 있게 되었습니다. 직무코드 입력 시 자동으로 직무명이 표시되어 편리성이 크게 향상되었습니다.

## 관련 파일
- **수정 파일**: [settings_dialog.py](src/ui/settings_dialog.py)
- **참조 모듈**: [job_data.py](src/domain/constants/job_data.py)
